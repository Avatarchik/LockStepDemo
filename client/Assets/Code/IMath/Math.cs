namespace IM
{
    public static class Math
    {
        public const int FACTOR = 1000;
        public const int SQR_FACTOR = FACTOR * FACTOR;
        public const int SUPPORTED_MIN = -23 * FACTOR;
        public const int SUPPORTED_MAX = 23 * FACTOR;
        public const int PI = (int)(3.14159265358979323846264338327950288 * FACTOR);
        public const int TWO_PI = (int)(6.28318530717958647692528676655900576 * FACTOR);
        public const int ROOT_PI = (int)(1.772453850905516027 * FACTOR);
        public const int HALF_PI = (int)(1.57079632679489661923132169163975144 * FACTOR);

        public static void CheckRange(int x, string name = "")
        {
            if (x < SUPPORTED_MIN || x > SUPPORTED_MAX)
            {
                throw new System.ArgumentOutOfRangeException(
                    string.Format("Number {0}:{1} out of range:({2}, {3})", name, x, SUPPORTED_MIN, SUPPORTED_MAX));
            }
        }

        public static int Deg2Rad(int degrees)
        {
            const long X = (long)(0.01745329251994329576923690768489 * FACTOR * FACTOR);
            return (int)Math.RndDiv(Math.RndDiv(degrees * X, FACTOR), FACTOR);
        }

        public static int Rad2Deg(int radians)
        {
            //const long X = (long)(57.295779513082320876798154814105 * SQR_FACTOR * SQR_FACTOR);
            //return (int)(radians * X / SQR_FACTOR / SQR_FACTOR / FACTOR);
            const long X = (long)(57.296 * FACTOR);
            return (int)(Math.RndDiv(radians * X, FACTOR));
        }

        public static int Min(int x, int y)
        {
            return x < y ? x : y;
        }

        public static long Min(long x, long y)
        {
            return x < y ? x : y;
        }

        public static int Max(int x, int y)
        {
            return x > y ? x : y;
        }

        public static long Max(long x, long y)
        {
            return x > y ? x : y;
        }

        public static int Clamp(int x, int min, int max)
        {
            if (x < min)
                return min;
            else if (x > max)
                return max;
            else
                return x;
        }

        public static long Clamp(long x, long min, long max)
        {
            if (x < min)
                return min;
            else if (x > max)
                return max;
            else
                return x;
        }

        public static int Sign(int x)
        {
            return x >= 0 ? 1 : -1;
        }

        public static long Sign(long x)
        {
            return x >= 0L ? 1L : -1L;
        }

        public static int RndDiv(int x, int y)
        {
            return (int)RndDiv((long)x, (long)y);
        }
        public static long RndDiv(long x, long y)
        {
            if (x == 0L)
                return 0L;
            if (y == 0L)
                throw new System.DivideByZeroException();

            long sign = Sign(x) * Sign(y);
            long absX = Abs(x);
            long absY = Abs(y);
            long q = absX / absY;
            long m = absX % absY;
            long m2 = m * 2L;
            if (m2 > absY)
                return sign * (q + 1L);
            else if (m2 < absY)
                return sign * q;
            else
            {
                long r = q + 1L;
                r = (r >> 1) << 1;
                return sign * r;
            }
        }

        public static int Abs(int x)
        {
            return System.Math.Abs(x);
        }

        public static long Abs(long x)
        {
            return System.Math.Abs(x);
        }

        //The parameter radians should be factor multiplied
        public static int WrapAngle(int radians)
        {
            return Abs(radians % TWO_PI);
        }

        //The parameter radians should be factor multiplied
        public static int Cos(int radians)
        {
            CheckRange(radians, "Cos(radians)");
            return fastCos(radians);
        }

        //The parameter radians should be factor multiplied
        public static int Sin(int radians)
        {
            CheckRange(radians, "Sin(radians)");
            return fastSin(radians);
        }

        //The parameter radians should be factor multiplied
        public static int Asin(int x)
        {
            CheckRange(x, "Asin(x)");
            return fastAsin(x);
        }

        public static int Acos(int x)
        {
            CheckRange(x, "Acos(x)");
            return 1571 - fastAsin(x);
        }

        static int cos_52s(int x)
        {
            long xx = (long)x * x;
            Utils.Trace(string.Format("x:{0} xx:{1}", x, xx));

            const long A = (long)(0.9999932946f * SQR_FACTOR);
            const long B = (long)(-0.4999124376f * SQR_FACTOR);
            const long C = (long)(0.0414877472f * SQR_FACTOR);
            const long D = (long)(-0.0012712095f * SQR_FACTOR);
            Utils.Trace(string.Format("A:{0} B:{1} C:{2} D:{3}", A, B, C, D));

            long r1 = C + Math.RndDiv(xx * D, SQR_FACTOR);
            long r2 = B + Math.RndDiv(xx * r1, SQR_FACTOR);
            long r3 = A + Math.RndDiv(xx * r2, SQR_FACTOR);
            Utils.Trace(string.Format("r1:{0} r2:{1} r3:{2}", r1, r2, r3));

            return (int)Math.RndDiv(r3, FACTOR);
        }

        static int fastCos(int radians)
        {
            int angle = WrapAngle(radians);

            if (angle < HALF_PI)
                return cos_52s(angle);
            if (angle < PI)
                return -cos_52s(PI - angle);
            if (angle < (3 * HALF_PI))
                return -cos_52s(angle - PI);

            return cos_52s(TWO_PI - angle);
        }

        static int fastSin(int radians)
        {
            return fastCos(HALF_PI - radians);
        }

        static int[] asinTable = { 
            0, 	1, 	2, 	3, 	4, 	5, 	6, 	7, 	8, 	9, 	
            10, 	11, 	12, 	13, 	14, 	15, 	16, 	17, 	18, 	19, 	
            20, 	21, 	22, 	23, 	24, 	25, 	26, 	27, 	28, 	29, 	
            30, 	31, 	32, 	33, 	34, 	35, 	36, 	37, 	38, 	39, 	
            40, 	41, 	42, 	43, 	44, 	45, 	46, 	47, 	48, 	49, 	
            50, 	51, 	52, 	53, 	54, 	55, 	56, 	57, 	58, 	59, 	
            60, 	61, 	62, 	63, 	64, 	65, 	66, 	67, 	68, 	69, 	
            70, 	71, 	72, 	73, 	74, 	75, 	76, 	77, 	78, 	79, 	
            80, 	81, 	82, 	83, 	84, 	85, 	86, 	87, 	88, 	89, 	
            90, 	91, 	92, 	93, 	94, 	95, 	96, 	97, 	98, 	99, 	
            100, 	101, 	102, 	103, 	104, 	105, 	106, 	107, 	108, 	109, 	
            110, 	111, 	112, 	113, 	114, 	115, 	116, 	117, 	118, 	119, 	
            120, 	121, 	122, 	123, 	124, 	125, 	126, 	127, 	128, 	129, 	
            130, 	131, 	132, 	133, 	134, 	135, 	136, 	137, 	138, 	139, 	
            140, 	141, 	142, 	143, 	145, 	146, 	147, 	148, 	149, 	150, 	
            151, 	152, 	153, 	154, 	155, 	156, 	157, 	158, 	159, 	160, 	
            161, 	162, 	163, 	164, 	165, 	166, 	167, 	168, 	169, 	170, 	
            171, 	172, 	173, 	174, 	175, 	176, 	177, 	178, 	179, 	180, 	
            181, 	182, 	183, 	184, 	185, 	186, 	187, 	188, 	189, 	190, 	
            191, 	192, 	193, 	194, 	195, 	196, 	197, 	198, 	199, 	200, 	
            201, 	202, 	203, 	204, 	205, 	206, 	207, 	209, 	210, 	211, 	
            212, 	213, 	214, 	215, 	216, 	217, 	218, 	219, 	220, 	221, 	
            222, 	223, 	224, 	225, 	226, 	227, 	228, 	229, 	230, 	231, 	
            232, 	233, 	234, 	235, 	236, 	237, 	238, 	239, 	240, 	241, 	
            242, 	243, 	244, 	245, 	246, 	248, 	249, 	250, 	251, 	252, 	
            253, 	254, 	255, 	256, 	257, 	258, 	259, 	260, 	261, 	262, 	
            263, 	264, 	265, 	266, 	267, 	268, 	269, 	270, 	271, 	272, 	
            273, 	274, 	275, 	277, 	278, 	279, 	280, 	281, 	282, 	283, 	
            284, 	285, 	286, 	287, 	288, 	289, 	290, 	291, 	292, 	293, 	
            294, 	295, 	296, 	297, 	298, 	299, 	301, 	302, 	303, 	304, 	
            305, 	306, 	307, 	308, 	309, 	310, 	311, 	312, 	313, 	314, 	
            315, 	316, 	317, 	318, 	319, 	320, 	322, 	323, 	324, 	325, 	
            326, 	327, 	328, 	329, 	330, 	331, 	332, 	333, 	334, 	335, 	
            336, 	337, 	338, 	339, 	341, 	342, 	343, 	344, 	345, 	346, 	
            347, 	348, 	349, 	350, 	351, 	352, 	353, 	354, 	355, 	357, 	
            358, 	359, 	360, 	361, 	362, 	363, 	364, 	365, 	366, 	367, 	
            368, 	369, 	370, 	371, 	373, 	374, 	375, 	376, 	377, 	378, 	
            379, 	380, 	381, 	382, 	383, 	384, 	385, 	387, 	388, 	389, 	
            390, 	391, 	392, 	393, 	394, 	395, 	396, 	397, 	398, 	400, 	
            401, 	402, 	403, 	404, 	405, 	406, 	407, 	408, 	409, 	410, 	
            412, 	413, 	414, 	415, 	416, 	417, 	418, 	419, 	420, 	421, 	
            422, 	424, 	425, 	426, 	427, 	428, 	429, 	430, 	431, 	432, 	
            433, 	435, 	436, 	437, 	438, 	439, 	440, 	441, 	442, 	443, 	
            444, 	446, 	447, 	448, 	449, 	450, 	451, 	452, 	453, 	454, 	
            456, 	457, 	458, 	459, 	460, 	461, 	462, 	463, 	465, 	466, 	
            467, 	468, 	469, 	470, 	471, 	472, 	473, 	475, 	476, 	477, 	
            478, 	479, 	480, 	481, 	483, 	484, 	485, 	486, 	487, 	488, 	
            489, 	490, 	492, 	493, 	494, 	495, 	496, 	497, 	498, 	500, 	
            501, 	502, 	503, 	504, 	505, 	506, 	508, 	509, 	510, 	511, 	
            512, 	513, 	514, 	516, 	517, 	518, 	519, 	520, 	521, 	522, 	
            524, 	525, 	526, 	527, 	528, 	529, 	531, 	532, 	533, 	534, 	
            535, 	536, 	538, 	539, 	540, 	541, 	542, 	543, 	545, 	546, 	
            547, 	548, 	549, 	550, 	552, 	553, 	554, 	555, 	556, 	557, 	
            559, 	560, 	561, 	562, 	563, 	565, 	566, 	567, 	568, 	569, 	
            570, 	572, 	573, 	574, 	575, 	576, 	578, 	579, 	580, 	581, 	
            582, 	584, 	585, 	586, 	587, 	588, 	590, 	591, 	592, 	593, 	
            594, 	596, 	597, 	598, 	599, 	600, 	602, 	603, 	604, 	605, 	
            607, 	608, 	609, 	610, 	611, 	613, 	614, 	615, 	616, 	618, 	
            619, 	620, 	621, 	622, 	624, 	625, 	626, 	627, 	629, 	630, 	
            631, 	632, 	634, 	635, 	636, 	637, 	639, 	640, 	641, 	642, 	
            644, 	645, 	646, 	647, 	649, 	650, 	651, 	652, 	654, 	655, 	
            656, 	657, 	659, 	660, 	661, 	662, 	664, 	665, 	666, 	667, 	
            669, 	670, 	671, 	673, 	674, 	675, 	676, 	678, 	679, 	680, 	
            682, 	683, 	684, 	685, 	687, 	688, 	689, 	691, 	692, 	693, 	
            694, 	696, 	697, 	698, 	700, 	701, 	702, 	704, 	705, 	706, 	
            708, 	709, 	710, 	712, 	713, 	714, 	716, 	717, 	718, 	719, 	
            721, 	722, 	723, 	725, 	726, 	727, 	729, 	730, 	732, 	733, 	
            734, 	736, 	737, 	738, 	740, 	741, 	742, 	744, 	745, 	746, 	
            748, 	749, 	750, 	752, 	753, 	755, 	756, 	757, 	759, 	760, 	
            761, 	763, 	764, 	766, 	767, 	768, 	770, 	771, 	773, 	774, 	
            775, 	777, 	778, 	780, 	781, 	782, 	784, 	785, 	787, 	788, 	
            789, 	791, 	792, 	794, 	795, 	797, 	798, 	799, 	801, 	802, 	
            804, 	805, 	807, 	808, 	810, 	811, 	812, 	814, 	815, 	817, 	
            818, 	820, 	821, 	823, 	824, 	826, 	827, 	829, 	830, 	832, 	
            833, 	835, 	836, 	838, 	839, 	841, 	842, 	844, 	845, 	847, 	
            848, 	850, 	851, 	853, 	854, 	856, 	857, 	859, 	860, 	862, 	
            863, 	865, 	866, 	868, 	869, 	871, 	873, 	874, 	876, 	877, 	
            879, 	880, 	882, 	884, 	885, 	887, 	888, 	890, 	891, 	893, 	
            895, 	896, 	898, 	899, 	901, 	903, 	904, 	906, 	908, 	909, 	
            911, 	912, 	914, 	916, 	917, 	919, 	921, 	922, 	924, 	926, 	
            927, 	929, 	931, 	932, 	934, 	936, 	937, 	939, 	941, 	942, 	
            944, 	946, 	948, 	949, 	951, 	953, 	954, 	956, 	958, 	960, 	
            961, 	963, 	965, 	967, 	968, 	970, 	972, 	974, 	976, 	977, 	
            979, 	981, 	983, 	985, 	986, 	988, 	990, 	992, 	994, 	995, 	
            997, 	999, 	1001, 	1003, 	1005, 	1007, 	1008, 	1010, 	1012, 	1014, 	
            1016, 	1018, 	1020, 	1022, 	1024, 	1026, 	1027, 	1029, 	1031, 	1033, 	
            1035, 	1037, 	1039, 	1041, 	1043, 	1045, 	1047, 	1049, 	1051, 	1053, 	
            1055, 	1057, 	1059, 	1061, 	1063, 	1065, 	1068, 	1070, 	1072, 	1074, 	
            1076, 	1078, 	1080, 	1082, 	1084, 	1086, 	1089, 	1091, 	1093, 	1095, 	
            1097, 	1100, 	1102, 	1104, 	1106, 	1108, 	1111, 	1113, 	1115, 	1117, 	
            1120, 	1122, 	1124, 	1127, 	1129, 	1131, 	1134, 	1136, 	1138, 	1141, 	
            1143, 	1146, 	1148, 	1151, 	1153, 	1156, 	1158, 	1160, 	1163, 	1166, 	
            1168, 	1171, 	1173, 	1176, 	1178, 	1181, 	1184, 	1186, 	1189, 	1192, 	
            1194, 	1197, 	1200, 	1203, 	1205, 	1208, 	1211, 	1214, 	1217, 	1220, 	
            1223, 	1226, 	1229, 	1232, 	1235, 	1238, 	1241, 	1244, 	1247, 	1250, 	
            1253, 	1256, 	1260, 	1263, 	1266, 	1270, 	1273, 	1276, 	1280, 	1283, 	
            1287, 	1291, 	1294, 	1298, 	1302, 	1305, 	1309, 	1313, 	1317, 	1321, 	
            1325, 	1329, 	1334, 	1338, 	1342, 	1347, 	1351, 	1356, 	1361, 	1365, 	
            1370, 	1376, 	1381, 	1386, 	1392, 	1397, 	1403, 	1409, 	1416, 	1422, 	
            1429, 	1437, 	1444, 	1452, 	1461, 	1471, 	1481, 	1493, 	1508, 	1526, 	
            1571
        };

        static int[] acosTable = { 
            1571, 	1570, 	1569, 	1568, 	1567, 	1566, 	1565, 	1564, 	1563, 	1562, 	
            1561, 	1560, 	1559, 	1558, 	1557, 	1556, 	1555, 	1554, 	1553, 	1552, 	
            1551, 	1550, 	1549, 	1548, 	1547, 	1546, 	1545, 	1544, 	1543, 	1542, 	
            1541, 	1540, 	1539, 	1538, 	1537, 	1536, 	1535, 	1534, 	1533, 	1532, 	
            1531, 	1530, 	1529, 	1528, 	1527, 	1526, 	1525, 	1524, 	1523, 	1522, 	
            1521, 	1520, 	1519, 	1518, 	1517, 	1516, 	1515, 	1514, 	1513, 	1512, 	
            1511, 	1510, 	1509, 	1508, 	1507, 	1506, 	1505, 	1504, 	1503, 	1502, 	
            1501, 	1500, 	1499, 	1498, 	1497, 	1496, 	1495, 	1494, 	1493, 	1492, 	
            1491, 	1490, 	1489, 	1488, 	1487, 	1486, 	1485, 	1484, 	1483, 	1482, 	
            1481, 	1480, 	1479, 	1478, 	1477, 	1476, 	1475, 	1474, 	1473, 	1472, 	
            1471, 	1470, 	1469, 	1468, 	1467, 	1466, 	1465, 	1464, 	1463, 	1462, 	
            1461, 	1460, 	1459, 	1458, 	1457, 	1456, 	1455, 	1454, 	1453, 	1452, 	
            1451, 	1449, 	1448, 	1447, 	1446, 	1445, 	1444, 	1443, 	1442, 	1441, 	
            1440, 	1439, 	1438, 	1437, 	1436, 	1435, 	1434, 	1433, 	1432, 	1431, 	
            1430, 	1429, 	1428, 	1427, 	1426, 	1425, 	1424, 	1423, 	1422, 	1421, 	
            1420, 	1419, 	1418, 	1417, 	1416, 	1415, 	1414, 	1413, 	1412, 	1411, 	
            1410, 	1409, 	1408, 	1407, 	1406, 	1405, 	1404, 	1403, 	1402, 	1401, 	
            1400, 	1399, 	1398, 	1397, 	1396, 	1395, 	1394, 	1393, 	1392, 	1391, 	
            1390, 	1389, 	1388, 	1387, 	1386, 	1385, 	1384, 	1383, 	1382, 	1381, 	
            1380, 	1379, 	1378, 	1377, 	1376, 	1375, 	1374, 	1372, 	1371, 	1370, 	
            1369, 	1368, 	1367, 	1366, 	1365, 	1364, 	1363, 	1362, 	1361, 	1360, 	
            1359, 	1358, 	1357, 	1356, 	1355, 	1354, 	1353, 	1352, 	1351, 	1350, 	
            1349, 	1348, 	1347, 	1346, 	1345, 	1344, 	1343, 	1342, 	1341, 	1340, 	
            1339, 	1338, 	1337, 	1336, 	1335, 	1334, 	1333, 	1332, 	1330, 	1329, 	
            1328, 	1327, 	1326, 	1325, 	1324, 	1323, 	1322, 	1321, 	1320, 	1319, 	
            1318, 	1317, 	1316, 	1315, 	1314, 	1313, 	1312, 	1311, 	1310, 	1309, 	
            1308, 	1307, 	1306, 	1305, 	1304, 	1303, 	1302, 	1301, 	1299, 	1298, 	
            1297, 	1296, 	1295, 	1294, 	1293, 	1292, 	1291, 	1290, 	1289, 	1288, 	
            1287, 	1286, 	1285, 	1284, 	1283, 	1282, 	1281, 	1280, 	1279, 	1278, 	
            1277, 	1276, 	1274, 	1273, 	1272, 	1271, 	1270, 	1269, 	1268, 	1267, 	
            1266, 	1265, 	1264, 	1263, 	1262, 	1261, 	1260, 	1259, 	1258, 	1257, 	
            1256, 	1255, 	1253, 	1252, 	1251, 	1250, 	1249, 	1248, 	1247, 	1246, 	
            1245, 	1244, 	1243, 	1242, 	1241, 	1240, 	1239, 	1238, 	1237, 	1236, 	
            1234, 	1233, 	1232, 	1231, 	1230, 	1229, 	1228, 	1227, 	1226, 	1225, 	
            1224, 	1223, 	1222, 	1221, 	1220, 	1219, 	1217, 	1216, 	1215, 	1214, 	
            1213, 	1212, 	1211, 	1210, 	1209, 	1208, 	1207, 	1206, 	1205, 	1204, 	
            1203, 	1201, 	1200, 	1199, 	1198, 	1197, 	1196, 	1195, 	1194, 	1193, 	
            1192, 	1191, 	1190, 	1189, 	1187, 	1186, 	1185, 	1184, 	1183, 	1182, 	
            1181, 	1180, 	1179, 	1178, 	1177, 	1176, 	1175, 	1173, 	1172, 	1171, 	
            1170, 	1169, 	1168, 	1167, 	1166, 	1165, 	1164, 	1163, 	1161, 	1160, 	
            1159, 	1158, 	1157, 	1156, 	1155, 	1154, 	1153, 	1152, 	1151, 	1149, 	
            1148, 	1147, 	1146, 	1145, 	1144, 	1143, 	1142, 	1141, 	1140, 	1138, 	
            1137, 	1136, 	1135, 	1134, 	1133, 	1132, 	1131, 	1130, 	1129, 	1127, 	
            1126, 	1125, 	1124, 	1123, 	1122, 	1121, 	1120, 	1119, 	1117, 	1116, 	
            1115, 	1114, 	1113, 	1112, 	1111, 	1110, 	1109, 	1107, 	1106, 	1105, 	
            1104, 	1103, 	1102, 	1101, 	1100, 	1098, 	1097, 	1096, 	1095, 	1094, 	
            1093, 	1092, 	1091, 	1089, 	1088, 	1087, 	1086, 	1085, 	1084, 	1083, 	
            1082, 	1080, 	1079, 	1078, 	1077, 	1076, 	1075, 	1074, 	1072, 	1071, 	
            1070, 	1069, 	1068, 	1067, 	1066, 	1064, 	1063, 	1062, 	1061, 	1060, 	
            1059, 	1058, 	1056, 	1055, 	1054, 	1053, 	1052, 	1051, 	1050, 	1048, 	
            1047, 	1046, 	1045, 	1044, 	1043, 	1041, 	1040, 	1039, 	1038, 	1037, 	
            1036, 	1034, 	1033, 	1032, 	1031, 	1030, 	1029, 	1027, 	1026, 	1025, 	
            1024, 	1023, 	1022, 	1020, 	1019, 	1018, 	1017, 	1016, 	1015, 	1013, 	
            1012, 	1011, 	1010, 	1009, 	1007, 	1006, 	1005, 	1004, 	1003, 	1002, 	
            1000, 	999, 	998, 	997, 	996, 	994, 	993, 	992, 	991, 	990, 	
            988, 	987, 	986, 	985, 	984, 	982, 	981, 	980, 	979, 	978, 	
            976, 	975, 	974, 	973, 	972, 	970, 	969, 	968, 	967, 	966, 	
            964, 	963, 	962, 	961, 	959, 	958, 	957, 	956, 	955, 	953, 	
            952, 	951, 	950, 	948, 	947, 	946, 	945, 	943, 	942, 	941, 	
            940, 	938, 	937, 	936, 	935, 	934, 	932, 	931, 	930, 	929, 	
            927, 	926, 	925, 	924, 	922, 	921, 	920, 	919, 	917, 	916, 	
            915, 	913, 	912, 	911, 	910, 	908, 	907, 	906, 	905, 	903, 	
            902, 	901, 	900, 	898, 	897, 	896, 	894, 	893, 	892, 	891, 	
            889, 	888, 	887, 	885, 	884, 	883, 	881, 	880, 	879, 	878, 	
            876, 	875, 	874, 	872, 	871, 	870, 	868, 	867, 	866, 	865, 	
            863, 	862, 	861, 	859, 	858, 	857, 	855, 	854, 	853, 	851, 	
            850, 	849, 	847, 	846, 	845, 	843, 	842, 	841, 	839, 	838, 	
            837, 	835, 	834, 	833, 	831, 	830, 	828, 	827, 	826, 	824, 	
            823, 	822, 	820, 	819, 	818, 	816, 	815, 	813, 	812, 	811, 	
            809, 	808, 	807, 	805, 	804, 	802, 	801, 	800, 	798, 	797, 	
            795, 	794, 	793, 	791, 	790, 	788, 	787, 	786, 	784, 	783, 	
            781, 	780, 	778, 	777, 	776, 	774, 	773, 	771, 	770, 	768, 	
            767, 	766, 	764, 	763, 	761, 	760, 	758, 	757, 	755, 	754, 	
            752, 	751, 	750, 	748, 	747, 	745, 	744, 	742, 	741, 	739, 	
            738, 	736, 	735, 	733, 	732, 	730, 	729, 	727, 	726, 	724, 	
            723, 	721, 	720, 	718, 	717, 	715, 	714, 	712, 	711, 	709, 	
            707, 	706, 	704, 	703, 	701, 	700, 	698, 	697, 	695, 	694, 	
            692, 	690, 	689, 	687, 	686, 	684, 	682, 	681, 	679, 	678, 	
            676, 	675, 	673, 	671, 	670, 	668, 	666, 	665, 	663, 	662, 	
            660, 	658, 	657, 	655, 	653, 	652, 	650, 	648, 	647, 	645, 	
            644, 	642, 	640, 	638, 	637, 	635, 	633, 	632, 	630, 	628, 	
            627, 	625, 	623, 	622, 	620, 	618, 	616, 	615, 	613, 	611, 	
            609, 	608, 	606, 	604, 	602, 	601, 	599, 	597, 	595, 	593, 	
            592, 	590, 	588, 	586, 	584, 	583, 	581, 	579, 	577, 	575, 	
            574, 	572, 	570, 	568, 	566, 	564, 	562, 	560, 	559, 	557, 	
            555, 	553, 	551, 	549, 	547, 	545, 	543, 	541, 	539, 	537, 	
            536, 	534, 	532, 	530, 	528, 	526, 	524, 	522, 	520, 	518, 	
            516, 	514, 	512, 	509, 	507, 	505, 	503, 	501, 	499, 	497, 	
            495, 	493, 	491, 	489, 	486, 	484, 	482, 	480, 	478, 	476, 	
            473, 	471, 	469, 	467, 	465, 	462, 	460, 	458, 	456, 	453, 	
            451, 	449, 	446, 	444, 	442, 	439, 	437, 	435, 	432, 	430, 	
            428, 	425, 	423, 	420, 	418, 	415, 	413, 	410, 	408, 	405, 	
            403, 	400, 	398, 	395, 	392, 	390, 	387, 	384, 	382, 	379, 	
            376, 	374, 	371, 	368, 	365, 	363, 	360, 	357, 	354, 	351, 	
            348, 	345, 	342, 	339, 	336, 	333, 	330, 	327, 	324, 	321, 	
            318, 	314, 	311, 	308, 	304, 	301, 	298, 	294, 	291, 	287, 	
            284, 	280, 	277, 	273, 	269, 	265, 	262, 	258, 	254, 	250, 	
            246, 	241, 	237, 	233, 	229, 	224, 	220, 	215, 	210, 	205, 	
            200, 	195, 	190, 	185, 	179, 	173, 	168, 	161, 	155, 	148, 	
            142, 	134, 	127, 	118, 	110, 	100, 	89, 	77, 	63, 	45, 	
            0};

        [UnityEditor.MenuItem("TriFunc/Generate Asin Table")]
        static void GenerateAsinTable()
        {
            System.Text.StringBuilder builder = new System.Text.StringBuilder();
            builder.Append("static int[] asinTable = { ");
            for (int i = 0; i <= Math.FACTOR; ++i)
            {
                int result = UnityEngine.Mathf.RoundToInt(UnityEngine.Mathf.Asin((float)i / Math.FACTOR) * Math.FACTOR);
                if (i % 10 == 0)
                    builder.Append("\n");
                builder.Append(result);
                if (i != Math.FACTOR)
                    builder.Append(", \t");
            }
            builder.Append("};");
            System.IO.File.AppendAllText("Assets/Code/IMath/Math.cs", builder.ToString());
        }

        [UnityEditor.MenuItem("TriFunc/Generate Acos Table")]
        static void GenerateAcosTable()
        {
            System.Text.StringBuilder builder = new System.Text.StringBuilder();
            builder.Append("static int[] asinTable = { ");
            for (int i = 0; i <= Math.FACTOR; ++i)
            {
                int result = UnityEngine.Mathf.RoundToInt(UnityEngine.Mathf.Acos((float)i / Math.FACTOR) * Math.FACTOR);
                if (i % 10 == 0)
                    builder.Append("\n");
                builder.Append(result);
                if (i != Math.FACTOR)
                    builder.Append(", \t");
            }
            builder.Append("};");
            System.IO.File.AppendAllText("Assets/Code/IMath/Math.cs", builder.ToString());
        }

        static int fastAsin(int x)
        {
            int sign = Sign(x);
            x = Clamp(Abs(x), 0, Math.FACTOR);
            int result = asinTable[x];
            return sign * result;
        }

        static int fastAcos(int x)
        {
            int sign = Sign(x);
            x = Clamp(Abs(x), 0, Math.FACTOR);
            int result = acosTable[x];
            return sign * result;
        }

        public static float fastInvSqrt(float x)
        {
            unsafe
            {
                float f = x;
                float xhalf = x * 0.5f;
                uint* p = (uint*)(&x);
                uint i = 0x5f3759df - (*p >> 1);
                float* pf = (float*)(&i);
                f = *pf;
                f = f * (1.5f - xhalf * f * f);
                return f;
            }
        }

        static int[] sqrtTable = {
            0,    16,  22,  27,  32,  35,  39,  42,  45,  48,  50,  53,  55,  57,
            59,   61,  64,  65,  67,  69,  71,  73,  75,  76,  78,  80,  81,  83,
            84,   86,  87,  89,  90,  91,  93,  94,  96,  97,  98,  99, 101, 102,
            103, 104, 106, 107, 108, 109, 110, 112, 113, 114, 115, 116, 117, 118,
            119, 120, 121, 122, 123, 124, 125, 126, 128, 128, 129, 130, 131, 132,
            133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 144, 145,
            146, 147, 148, 149, 150, 150, 151, 152, 153, 154, 155, 155, 156, 157,
            158, 159, 160, 160, 161, 162, 163, 163, 164, 165, 166, 167, 167, 168,
            169, 170, 170, 171, 172, 173, 173, 174, 175, 176, 176, 177, 178, 178,
            179, 180, 181, 181, 182, 183, 183, 184, 185, 185, 186, 187, 187, 188,
            189, 189, 190, 191, 192, 192, 193, 193, 194, 195, 195, 196, 197, 197,
            198, 199, 199, 200, 201, 201, 202, 203, 203, 204, 204, 205, 206, 206,
            207, 208, 208, 209, 209, 210, 211, 211, 212, 212, 213, 214, 214, 215,
            215, 216, 217, 217, 218, 218, 219, 219, 220, 221, 221, 222, 222, 223,
            224, 224, 225, 225, 226, 226, 227, 227, 228, 229, 229, 230, 230, 231,
            231, 232, 232, 233, 234, 234, 235, 235, 236, 236, 237, 237, 238, 238,
            239, 240, 240, 241, 241, 242, 242, 243, 243, 244, 244, 245, 245, 246,
            246, 247, 247, 248, 248, 249, 249, 250, 250, 251, 251, 252, 252, 253,
            253, 254, 254, 255
        };

        public static int Sqrt(int n)
        {
            if (n < 0)
                throw new System.ArgumentException("Argument of Sqrt shouldn't be negative." + n);
            int xn;
            if (n >= 0x7FFEA810) return 0xB504;
            if (n >= 0x10000)
            {
                if (n >= 0x1000000)
                {
                    if (n >= 0x10000000)
                    {
                        if (n >= 0x40000000)
                        {
                            xn = sqrtTable[n >> 24] << 8;
                        }
                        else
                        {
                            xn = sqrtTable[n >> 22] << 7;
                        }
                    }
                    else
                    {
                        if (n >= 0x4000000)
                        {
                            xn = sqrtTable[n >> 20] << 6;
                        }
                        else
                        {
                            xn = sqrtTable[n >> 18] << 5;
                        }
                    }

                    xn = (xn + 1 + (n / xn)) >> 1;
                    xn = (xn + 1 + (n / xn)) >> 1;
                    return ((xn * xn) > n) ? --xn : xn;
                }
                else
                {
                    if (n >= 0x100000)
                    {
                        if (n >= 0x400000)
                        {
                            xn = sqrtTable[n >> 16] << 4;
                        }
                        else
                        {
                            xn = sqrtTable[n >> 14] << 3;
                        }
                    }
                    else
                    {
                        if (n >= 0x40000)
                        {
                            xn = sqrtTable[n >> 12] << 2;
                        }
                        else
                        {
                            xn = sqrtTable[n >> 10] << 1;
                        }
                    }

                    xn = (xn + 1 + (n / xn)) >> 1;
                    return ((xn * xn) > n) ? --xn : xn;
                }
            }
            else
            {
                if (n >= 0x100)
                {
                    if (n >= 0x1000)
                    {
                        if (n >= 0x4000)
                        {
                            xn = (sqrtTable[n >> 8]) + 1;
                        }
                        else
                        {
                            xn = (sqrtTable[n >> 6] >> 1) + 1;
                        }
                    }
                    else
                    {
                        if (n >= 0x400)
                        {
                            xn = (sqrtTable[n >> 4] >> 2) + 1;
                        }
                        else
                        {
                            xn = (sqrtTable[n >> 2] >> 3) + 1;
                        }
                    }
                    return ((xn * xn) > n) ? --xn : xn;
                }
                else
                {
                    if (n >= 0)
                    {
                        return sqrtTable[n] >> 4;
                    }
                }
            }
            return -1;
        }
    }
}
